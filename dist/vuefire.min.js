/*!
 * vuefire v2.0.0-alpha.7
 * (c) 2018 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(i.Vuefire={})}(this,function(i){"use strict";var t=function(i,t,e,n,o){this.vm=i,this.key=t,this.source=e,this.onReady=n,this.onError=o,this.initialValue=null};t.prototype.bind=function(){throw new Error("[bind] must be implemented in children.")},t.prototype._init=function(i){this.defineReactive(this.vm,this.key,i)},t.prototype.unbind=function(){this.off&&this.off(),this.vm[this.key]=this.initialValue};function e(i){if("function"!=typeof i)throw new Error("Must pass a function.");var t=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];i.apply(void 0,e),t=function(){}};return t}function n(i){var t=i.exists?i.data():{};return t[".id"]=i.id,t[".ref"]=i.ref,t}function o(i){for(var t=[];i;)t.unshift(i.id),i=i.parent;var e=i.firestore._databaseId;return t.unshift(e.database),t.unshift(e.projectId),i.firebase.segments.join("/")}var r=function(i){function t(t,e,n,o,r){if(i.apply(this,arguments),!this.source.firestore||!this.source.collection)throw new Error("Not a valid Firestore DocumentReference to bind.");this.initialValue={}}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.path=function(){return o(this.source)},t.prototype.init=function(){this.onReadyOnce=e(this.onReady),this._init(this.initialValue)},t.prototype.bind=function(){var i=this,t=this.source.onSnapshot(function(t){i.vm[i.key]=n(t),i.onReadyOnce()},this.onError);this.off=e(t)},t}(t),s=function(i){function t(t,e,n,o,r){if(i.apply(this,arguments),!this.source.firestore||!this.source.where)throw new Error("Not a valid Firestore CollectionReference or Query to bind.");this.initialValue=[]}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.path=function(){return o(this.source)},t.prototype.init=function(){this.onReadyOnce=e(this.onReady),this._init(this.initialValue)},t.prototype.bind=function(){var i=this;this.unbind();var t=this.source.onSnapshot(function(t){t.docChanges.forEach(function(t){switch(t.type){case"added":i.initialValue.splice(t.newIndex,0,n(t.doc));break;case"modified":var e=n(t.doc);t.oldIndex===t.newIndex?i.initialValue.splice(t.oldIndex,1,e):(i.initialValue.splice(t.oldIndex,1),i.initialValue.splice(t.newIndex,0,e));break;case"removed":i.initialValue.splice(t.oldIndex,1)}}),i.onReadyOnce()},this.onError);this.off=e(t)},t}(t);function a(i){return"function"==typeof i.key?i.key():i.key}function c(i){return"[object Object]"===Object.prototype.toString.call(i)}function u(i,t){for(var e=0;e<i.length;e++)if(i[e][".key"]===t)return e;return-1}function f(i){var t=i.val(),e=c(t)?t:{".value":t};e[".key"]=a(i),e[".ref"]=(n=i,"function"==typeof n.ref?n=n.ref():"object"==typeof n.ref&&(n=n.ref),n);var n;return e}var l,d=function(i){function t(t,e,n,o,r){if(i.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue=[]}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.init=function(){this._init(this.initialValue)},t.prototype.bind=function(){var i=this;this.unbind();var t=this.source.on("child_added",function(t,e){var n=e?u(i.initialValue,e)+1:0;i.initialValue.splice(n,0,f(t))},this.onError),n=this.source.on("child_removed",function(t){var e=u(i.initialValue,a(t));i.initialValue.splice(e,1)},this.onError),o=this.source.on("child_changed",function(t){var e=u(i.initialValue,a(t));i.initialValue.splice(e,1,f(t))},this.onError),r=this.source.on("child_moved",function(t,e){var n=u(i.initialValue,a(t)),o=i.initialValue.splice(n,1)[0],r=e?u(i.initialValue,e)+1:0;i.initialValue.splice(r,0,o)},this.onError);this.off=e(function(){i.source.off("child_added",t),i.source.off("child_removed",n),i.source.off("child_changed",o),i.source.off("child_moved",r)}),this.source.once("value",this.onReady.bind(this.vm))},t}(t),h=function(i){function t(t,e,n,o,r){if(i.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue={}}return i&&(t.__proto__=i),t.prototype=Object.create(i&&i.prototype),t.prototype.constructor=t,t.prototype.init=function(){this._init(this.initialValue)},t.prototype.bind=function(){var i=this;this.unbind();var t=this.source.on("value",function(t){i.vm[i.key]=f(t)},this.onError);this.source.once("value",this.onReady),this.off=e(function(){i.source.off("value",t)})},t}(t);t.prototype.defineReactive=function(i,t,e){t in i?i[t]=e:l.util.defineReactive(i,t,e)};function p(i,t,e){var n=!1,o=null,a=null;if(c(e)&&e.hasOwnProperty("source")&&(n=e.asObject,o=e.cancelCallback,a=e.readyCallback,e=e.source),!c(e))throw new Error("VueFire: invalid Firebase binding source.");o=o||function(){},a=a||function(){};var u=new(n?e.firestore?r:h:e.firestore?s:d)(i,t,e,a.bind(i),o.bind(i));u.init(),u.bind(),i.$firebaseBinders[t]=u}function y(i){i.$firebaseBinders||(i.$firebaseBinders=Object.create(null))}var b={created:function(){y(this);var i=this.$options.firebase;if("function"==typeof i&&(i=i.call(this)),i)for(var t in i)p(this,t,i[t])},beforeDestroy:function(){if(this.$firebaseBinders){for(var i in this.$firebaseBinders)this.$firebaseBinders[i]&&this.$unbind(i);this.$firebaseBinders=null}}};function v(i){(l=i).mixin(b);var t=l.config.optionMergeStrategies;t.firebase=t.provide,l.prototype.$bindAsObject=function(i,t,e,n){y(this),p(this,i,{source:t,asObject:!0,cancelCallback:e,readyCallback:n})},l.prototype.$bindAsArray=function(i,t,e,n){y(this),p(this,i,{source:t,cancelCallback:e,readyCallback:n})},l.prototype.$unbind=function(i){!function(i,t){var e=i.$firebaseBinders[t];e&&e.unbind()}(this,i)}}"undefined"!=typeof window&&window.Vue&&v(window.Vue),i.default=v,Object.defineProperty(i,"__esModule",{value:!0})});