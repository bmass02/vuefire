/*!
 * vuefire v2.0.0-alpha.7
 * (c) 2018 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuefire={})}(this,function(t){"use strict";var e=function(t,e,i){this.vm=t,this.key=e,this.source=i,this.initialValue=null};e.prototype.bind=function(){return new Promise(function(){throw new Error("[bind] must be implemented in children.")})},e.prototype._init=function(t){this.defineReactive(this.vm,this.key,t)},e.prototype.unbind=function(){this.off&&this.off(),this.vm[this.key]=this.initialValue};function i(t){if("function"!=typeof t)throw new Error("Must pass a function.");var e=function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];t.apply(void 0,i),e=function(){}};return e}function n(t,e){if(!isFirestoreDoc(t)&&!isFirebaseRef(t))throw new Error("Only Firestore DocumentReferences can be converted to a path.");for(var i=[],n=t;n;)i.unshift(e(n)),n=n.parent;return i.join("/")}function o(t){var e=t.exists?t.data():{};return Object.defineProperty(e,".id",{value:t.id}),e[".path"]=n(t.ref,function(t){return t.id}),e}function r(t){for(var e=[];t;)e.unshift(t.id),t=t.parent;var i=t.firestore._databaseId;return e.unshift(i.database),e.unshift(i.projectId),t.firebase.segments.join("/")}var s=function(t){function e(e,i,n){if(t.apply(this,arguments),!this.source.firestore||!this.source.collection)throw new Error("Not a valid Firestore DocumentReference to bind.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.path=function(){return r(this.source)},e.prototype.init=function(){this._init(this.initialValue)},e.prototype.bind=function(){var t=this;return new Promise(function(e,n){var r=i(e),s=t.source.onSnapshot(function(e){t.vm[t.key]=o(e),r()},n);t.off=i(s)})},e}(e),u=function(t){function e(e,i,n){if(t.apply(this,arguments),!this.source.firestore||!this.source.where)throw new Error("Not a valid Firestore CollectionReference or Query to bind.");this.initialValue=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.path=function(){return r(this.source)},e.prototype.init=function(){this._init(this.initialValue)},e.prototype.add=function(t,e){this.vm[this.key].splice(t,0,e)},e.prototype.update=function(t,e){this.vm[this.key].splice(t,1,e)},e.prototype.delete=function(t){this.vm[this.key].splice(t,1)},e.prototype.bind=function(){var t=this;return this.unbind(),new Promise(function(e,n){var r=i(e),s=t.source.onSnapshot(function(e){(i=e,"function"==typeof i.docChanges?i.docChanges():i.docChanges).forEach(function(e){switch(e.type){case"added":t.add(e.newIndex,o(e.doc));break;case"modified":var i=o(e.doc);e.oldIndex===e.newIndex?t.update(e.oldIndex,i):(t.delete(e.oldIndex),t.add(e.newIndex,i));break;case"removed":t.delete(e.oldIndex)}});var i;r()},n);t.off=i(s)})},e}(e);function c(t){return"function"==typeof t.key?t.key():t.key}function f(t){return"[object Object]"===Object.prototype.toString.call(t)}function a(t,e){for(var i=0;i<t.length;i++)if(t[i][".key"]===e)return i;return-1}function d(t){var e=t.val(),i=f(e)?e:{".value":e};i[".key"]=c(t),i[".path"]=n((o=t,"function"==typeof o.ref?o=o.ref():"object"==typeof o.ref&&(o=o.ref),o));var o;return i}var p,h=function(t){function e(e,i,n){if(t.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){this._init(this.initialValue)},e.prototype.add=function(t,e){this.vm[this.key].splice(t,0,e)},e.prototype.update=function(t,e){this.vm[this.key].splice(t,1,e)},e.prototype.delete=function(t){return this.vm[this.key].splice(t,1)[0]},e.prototype.bind=function(){var t=this;this.unbind();var e=this.source.on("child_added",function(e,i){var n=i?a(t.initialValue,i)+1:0;t.add(n,d(e))}),n=this.source.on("child_removed",function(e){var i=a(t.initialValue,c(e));t.delete(i)}),o=this.source.on("child_changed",function(e){var i=a(t.initialValue,c(e));t.update(i,d(e))}),r=this.source.on("child_moved",function(e,i){var n=a(t.initialValue,c(e)),o=t.delete(n),r=i?a(t.initialValue,i)+1:0;t.add(r,o)});return this.off=i(function(){t.source.off("child_added",e),t.source.off("child_removed",n),t.source.off("child_changed",o),t.source.off("child_moved",r)}),this.source.once("value")},e}(e),l=function(t){function e(e,i,n){if(t.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){this._init(this.initialValue)},e.prototype.bind=function(){var t=this;this.unbind();var e=this.source.on("value",function(e){t.vm[t.key]=d(e)});return this.off=i(function(){t.source.off("value",e)}),this.source.once("value")},e}(e);e.prototype.defineReactive=function(t,e,i){e in t?t[e]=i:p.util.defineReactive(t,e,i)};function y(t,e,i){if(!f(i.source))throw new Error("VueFire: invalid Firebase binding source.");var n=i.source,o=new(n.firestore?n.where?u:s:i.asObject?l:h)(t,e,n);return t.$firebaseBinders[e]=o,o.init(),o.bind()}function v(t){t.$firebaseBinders||p.util.defineReactive(t,"$firebaseBinders",Object.create(null))}var b={created:function(){v(this);function t(t,e){"function"==typeof e&&(e=e.call(this));for(var i in e)y(t,i,e[i])}t(this,this.$options.firebase),t(this,this.$options.firestore)},beforeDestroy:function(){if(this.$firebaseBinders){for(var t in this.$firebaseBinders)this.$firebaseBinders[t]&&this.$unbind(t);this.$firebaseBinders=null}}};function w(t){(p=t).mixin(b);var e=p.config.optionMergeStrategies;e.firebase=e.provide,p.prototype.$bindAsObject=function(t,e){return v(this),y(this,t,{source:e,asObject:!0})},p.prototype.$bindAsArray=function(t,e){return v(this),y(this,t,{source:e})},p.prototype.$unbind=function(t){!function(t,e){var i=t.$firebaseBinders[e];i&&(i.unbind(),delete t.$firebaseBinders[e])}(this,t)}}"undefined"!=typeof window&&window.Vue&&w(window.Vue),t.default=w,Object.defineProperty(t,"__esModule",{value:!0})});