/*!
 * vuefire v2.0.0-alpha.7
 * (c) 2018 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.Vuefire={})}(this,function(t){"use strict";var i=function(t,i,e,n,o){this.vm=t,this.key=i,this.source=e,this.onReady=n,this.onError=o,this.initialValue=null};i.prototype.bind=function(){throw new Error("[bind] must be implemented in children.")},i.prototype._init=function(t){this.defineReactive(this.vm,this.key,t)},i.prototype.unbind=function(){this.off&&this.off(),this.vm[this.key]=this.initialValue};function e(t){if("function"!=typeof t)throw new Error("Must pass a function.");var i=function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];t.apply(void 0,e),i=function(){}};return i}function n(t){var i=t.exists?t.data():{};return i[".id"]=t.id,i[".ref"]=t.ref,i}function o(t){for(var i=[];t;)i.unshift(t.id),t=t.parent;var e=t.firestore._databaseId;return i.unshift(e.database),i.unshift(e.projectId),t.firebase.segments.join("/")}var r=function(t){function i(i,e,n,o,r){if(t.apply(this,arguments),!this.source.firestore||!this.source.collection)throw new Error("Not a valid Firestore DocumentReference to bind.");this.initialValue={}}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.path=function(){return o(this.source)},i.prototype.init=function(){this.onReadyOnce=e(this.onReady),this._init(this.initialValue)},i.prototype.bind=function(){var t=this,i=this.source.onSnapshot(function(i){t.vm[t.key]=n(i),t.onReadyOnce()},this.onError);this.off=e(i)},i}(i),s=function(t){function i(i,e,n,o,r){if(t.apply(this,arguments),!this.source.firestore||!this.source.where)throw new Error("Not a valid Firestore CollectionReference or Query to bind.");this.initialValue=[]}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.path=function(){return o(this.source)},i.prototype.init=function(){this.onReadyOnce=e(this.onReady),this._init(this.initialValue)},i.prototype.add=function(t,i){this.vm[this.key].splice(t,0,i)},i.prototype.update=function(t,i){this.vm[this.key].splice(t,1,i)},i.prototype.delete=function(t){this.vm[this.key].splice(t,1)},i.prototype.bind=function(){var t=this;this.unbind();var i=this.source.onSnapshot(function(i){i.docChanges.forEach(function(i){switch(i.type){case"added":t.initialValue.splice(i.newIndex,0,n(i.doc)),t.add(i.newIndex,n(i.doc));break;case"modified":var e=n(i.doc);i.oldIndex===i.newIndex?t.update(i.oldIndex,e):(t.delete(i.oldIndex),t.add(i.newIndex,e));break;case"removed":t.delete(i.oldIndex)}}),t.onReadyOnce()},this.onError);this.off=e(i)},i}(i);function c(t){return"function"==typeof t.key?t.key():t.key}function a(t){return"[object Object]"===Object.prototype.toString.call(t)}function u(t,i){for(var e=0;e<t.length;e++)if(t[e][".key"]===i)return e;return-1}function f(t){var i=t.val(),e=a(i)?i:{".value":i};e[".key"]=c(t),e[".ref"]=(n=t,"function"==typeof n.ref?n=n.ref():"object"==typeof n.ref&&(n=n.ref),n);var n;return e}var d,h=function(t){function i(i,e,n,o,r){if(t.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue=[]}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.init=function(){this._init(this.initialValue)},i.prototype.bind=function(){var t=this;this.unbind();var i=this.source.on("child_added",function(i,e){var n=e?u(t.initialValue,e)+1:0;t.initialValue.splice(n,0,f(i))},this.onError),n=this.source.on("child_removed",function(i){var e=u(t.initialValue,c(i));t.initialValue.splice(e,1)},this.onError),o=this.source.on("child_changed",function(i){var e=u(t.initialValue,c(i));t.initialValue.splice(e,1,f(i))},this.onError),r=this.source.on("child_moved",function(i,e){var n=u(t.initialValue,c(i)),o=t.initialValue.splice(n,1)[0],r=e?u(t.initialValue,e)+1:0;t.initialValue.splice(r,0,o)},this.onError);this.off=e(function(){t.source.off("child_added",i),t.source.off("child_removed",n),t.source.off("child_changed",o),t.source.off("child_moved",r)}),this.source.once("value",this.onReady.bind(this.vm))},i}(i),l=function(t){function i(i,e,n,o,r){if(t.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue={}}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.init=function(){this._init(this.initialValue)},i.prototype.bind=function(){var t=this;this.unbind();var i=this.source.on("value",function(i){t.vm[t.key]=f(i)},this.onError);this.source.once("value",this.onReady),this.off=e(function(){t.source.off("value",i)})},i}(i);i.prototype.defineReactive=function(t,i,e){i in t?t[i]=e:d.util.defineReactive(t,i,e)};function p(t,i,e){var n=!1,o=null,c=null;if(a(e)&&e.hasOwnProperty("source")&&(n=e.asObject,o=e.cancelCallback,c=e.readyCallback,e=e.source),!a(e))throw new Error("VueFire: invalid Firebase binding source.");o=o||function(){},c=c||function(){};var u=new(n?e.firestore?r:l:e.firestore?s:h)(t,i,e,c.bind(t),o.bind(t));u.init(),u.bind(),t.$firebaseBinders[i]=u}function y(t){t.$firebaseBinders||(t.$firebaseBinders=Object.create(null))}var b={created:function(){y(this);var t=this.$options.firebase;if("function"==typeof t&&(t=t.call(this)),t)for(var i in t)p(this,i,t[i])},beforeDestroy:function(){if(this.$firebaseBinders){for(var t in this.$firebaseBinders)this.$firebaseBinders[t]&&this.$unbind(t);this.$firebaseBinders=null}}};function v(t){(d=t).mixin(b);var i=d.config.optionMergeStrategies;i.firebase=i.provide,d.prototype.$bindAsObject=function(t,i,e,n){y(this),p(this,t,{source:i,asObject:!0,cancelCallback:e,readyCallback:n})},d.prototype.$bindAsArray=function(t,i,e,n){y(this),p(this,t,{source:i,cancelCallback:e,readyCallback:n})},d.prototype.$unbind=function(t){!function(t,i){var e=t.$firebaseBinders[i];e&&e.unbind()}(this,t)}}"undefined"!=typeof window&&window.Vue&&v(window.Vue),t.default=v,Object.defineProperty(t,"__esModule",{value:!0})});