/*!
 * vuefire v2.0.0-alpha.7
 * (c) 2018 Eduardo San Martin Morote
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Vuefire={})}(this,function(t){"use strict";var e=function(t,e,i,n,o){this.vm=t,this.key=e,this.source=i,this.onReady=n,this.onError=o,this.initialValue=null};e.prototype.bind=function(){throw new Error("[bind] must be implemented in children.")},e.prototype._init=function(t){this.defineReactive(this.vm,this.key,t)},e.prototype.unbind=function(){this.off&&this.off(),this.vm[this.key]=this.initialValue};function i(t){if("function"!=typeof t)throw new Error("Must pass a function.");var e=function(){for(var i=[],n=arguments.length;n--;)i[n]=arguments[n];t.apply(void 0,i),e=function(){}};return e}function n(t){var e=t.exists?t.data():{};return Object.defineProperty(e,".id",{value:t.id}),e[".ref"]=t.ref,e}function o(t){for(var e=[];t;)e.unshift(t.id),t=t.parent;var i=t.firestore._databaseId;return e.unshift(i.database),e.unshift(i.projectId),t.firebase.segments.join("/")}var r=function(t){function e(e,i,n,o,r){if(t.apply(this,arguments),!this.source.firestore||!this.source.collection)throw new Error("Not a valid Firestore DocumentReference to bind.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.path=function(){return o(this.source)},e.prototype.init=function(){this._init(this.initialValue)},e.prototype.bind=function(){var t=this;return new Promise(function(e,o){var r=i(function(){t.onReady(),e()}),s=t.source.onSnapshot(function(e){t.vm[t.key]=n(e),r()},function(e){t.onError(e),o(e)});t.off=i(s)})},e}(e),s=function(t){function e(e,i,n,o,r){if(t.apply(this,arguments),!this.source.firestore||!this.source.where)throw new Error("Not a valid Firestore CollectionReference or Query to bind.");this.initialValue=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.path=function(){return o(this.source)},e.prototype.init=function(){this._init(this.initialValue)},e.prototype.add=function(t,e){this.vm[this.key].splice(t,0,e)},e.prototype.update=function(t,e){this.vm[this.key].splice(t,1,e)},e.prototype.delete=function(t){this.vm[this.key].splice(t,1)},e.prototype.bind=function(){var t=this;return this.unbind(),new Promise(function(e,o){var r=i(function(){t.onReady(),e()}),s=t.source.onSnapshot(function(e){e.docChanges.forEach(function(e){switch(e.type){case"added":t.add(e.newIndex,n(e.doc));break;case"modified":var i=n(e.doc);e.oldIndex===e.newIndex?t.update(e.oldIndex,i):(t.delete(e.oldIndex),t.add(e.newIndex,i));break;case"removed":t.delete(e.oldIndex)}}),r()},function(e){t.onError(e),o(e)});t.off=i(s)})},e}(e);function c(t){return"function"==typeof t.key?t.key():t.key}function u(t){return"[object Object]"===Object.prototype.toString.call(t)}function a(t,e){for(var i=0;i<t.length;i++)if(t[i][".key"]===e)return i;return-1}function f(t){var e=t.val(),i=u(e)?e:{".value":e};i[".key"]=c(t),i[".ref"]=(n=t,"function"==typeof n.ref?n=n.ref():"object"==typeof n.ref&&(n=n.ref),n);var n;return i}var d,p=function(t){function e(e,i,n,o,r){if(t.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue=[]}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){this._init(this.initialValue)},e.prototype.add=function(t,e){this.vm[this.key].splice(t,0,e)},e.prototype.update=function(t,e){this.vm[this.key].splice(t,1,e)},e.prototype.delete=function(t){return this.vm[this.key].splice(t,1)[0]},e.prototype.bind=function(){var t=this;this.unbind();var e=this.source.on("child_added",function(e,i){var n=i?a(t.initialValue,i)+1:0;t.add(n,f(e))},this.onError),n=this.source.on("child_removed",function(e){var i=a(t.initialValue,c(e));t.delete(i)},this.onError),o=this.source.on("child_changed",function(e){var i=a(t.initialValue,c(e));t.update(i,f(e))},this.onError),r=this.source.on("child_moved",function(e,i){var n=a(t.initialValue,c(e)),o=t.delete(n),r=i?a(t.initialValue,i)+1:0;t.add(r,o)},this.onError);return this.off=i(function(){t.source.off("child_added",e),t.source.off("child_removed",n),t.source.off("child_changed",o),t.source.off("child_moved",r)}),this.source.once("value").then(function(){t.onReady()})},e}(e),h=function(t){function e(e,i,n,o,r){if(t.apply(this,arguments),"function"!=typeof this.source.on)throw new Error("Not a valid source to bind.");this.initialValue={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.init=function(){this._init(this.initialValue)},e.prototype.bind=function(){var t=this;this.unbind();var e=this.source.on("value",function(e){t.vm[t.key]=f(e)},this.onError);return this.off=i(function(){t.source.off("value",e)}),this.source.once("value").then(function(){t.onReady()})},e}(e);e.prototype.defineReactive=function(t,e,i){e in t?t[e]=i:d.util.defineReactive(t,e,i)};function l(t,e,i){var n=!1,o=null,c=null;if(u(i)&&i.hasOwnProperty("source")&&(n=i.asObject,o=i.cancelCallback,c=i.readyCallback,i=i.source),!u(i))throw new Error("VueFire: invalid Firebase binding source.");o=o||function(){},c=c||function(){};var a=new(i.firestore?i.where?s:r:n?h:p)(t,e,i,c.bind(t),o.bind(t));return t.$firebaseBinders[e]=a,a.init(),a.bind()}function y(t){t.$firebaseBinders||d.util.defineReactive(t,"$firebaseBinders",Object.create(null))}var v={created:function(){y(this);function t(t,e){"function"==typeof e&&(e=e.call(this));for(var i in e)l(t,i,e[i])}t(this,this.$options.firebase),t(this,this.$options.firestore)},beforeDestroy:function(){if(this.$firebaseBinders){for(var t in this.$firebaseBinders)this.$firebaseBinders[t]&&this.$unbind(t);this.$firebaseBinders=null}}};function b(t){(d=t).mixin(v);var e=d.config.optionMergeStrategies;e.firebase=e.provide,d.prototype.$bindAsObject=function(t,e,i,n){return y(this),l(this,t,{source:e,asObject:!0,cancelCallback:i,readyCallback:n})},d.prototype.$bindAsArray=function(t,e,i,n){return y(this),l(this,t,{source:e,cancelCallback:i,readyCallback:n})},d.prototype.$unbind=function(t){!function(t,e){var i=t.$firebaseBinders[e];i&&(i.unbind(),delete t.$firebaseBinders[e])}(this,t)}}"undefined"!=typeof window&&window.Vue&&b(window.Vue),t.default=b,Object.defineProperty(t,"__esModule",{value:!0})});